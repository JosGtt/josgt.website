---
// src/components/SobreMi.astro
import WSP from '../components/icons/WSP.astro';
import Gmail from '../components/icons/Gmail.astro';
import LN from '../components/icons/LN.astro';
import CV from '../components/icons/CV.astro';
---
<section id="sobremi" class="py-20 px-4 md:px-16 bg-[var(--toggle-bg)] transition-colors">
  <h2 class="text-3xl font-bold text-center mb-6 text-[var(--toggle-sun)] dark:text-[var(--toggle-sun-dark)]">
    Sobre mí
  </h2>

  <!-- Texto: hereda color (sin color explícito) -->
  <p class="max-w-2xl mx-auto text-center text-lg leading-relaxed mb-12">
    Soy un desarrollador con total disponibilidad y dedicación inmediata al trabajo.
    Como estudiante con más de <strong>1 año de aprendizaje intensivo</strong>,
    busco oportunidades laborales donde aportar mis conocimientos y seguir creciendo.
  </p>

  <!-- Iconos mucho más abajo -->
  <div class="flex justify-center mt-32">
    <div class="flex items-center gap-6">

      <!-- WhatsApp: botón que muestra popover con QR encima -->
      <div class="relative">
        <button
          id="wspBtn"
          class="tech-pill tech-wsp inline-flex items-center justify-center rounded-full border-0 bg-transparent p-1"
          aria-label="WhatsApp"
          type="button"
        >
          <span class="tech-icon fill-current inline-block" style="width:40px;height:40px;">
            <WSP class="w-full h-full fill-current" />
          </span>
        </button>

          <!-- popover QR (inicialmente oculto) -->
          <div id="wspPopover" class="hidden absolute -top-64 left-1/2 transform -translate-x-1/2 w-44  rounded-xl shadow-lg z-50 p-3 text-center">
            <button id="wspClose" class="absolute right-2 top-2 text-sm opacity-80 hover:opacity-100" aria-label="Cerrar">✕</button>
            <img id="wspImg" src="/assets/jose.png" alt="QR WhatsApp" class="mx-auto w-55 h-55 object-cover rounded-md" />
            <p id="wspImgError" class="hidden mt-2 text-xs text-red-600 dark:text-red-400">No se encontró la imagen. Revisa `/public/assets/jose.jpeg`.</p>
            <p class="mt-2 text-xs text-[var(--text-light)]   ">Escanea o guarda mi contacto</p>
          </div>
        </div>

      <!-- Gmail: copia email -->
      <div class="relative">
        <button
          id="gmailBtn"
          class="tech-pill tech-gmail inline-flex items-center justify-center rounded-full border-0 bg-transparent p-1"
          aria-label="Gmail - copiar email"
          type="button"
        >
          <span class="tech-icon fill-current inline-block" style="width:40px;height:40px;">
            <Gmail class="w-full h-full fill-current" />
          </span>
        </button>
      </div>

      <!-- LinkedIn: enlace -->
      <a
        id="lnLink"
        class="tech-pill tech-linkedin inline-flex items-center justify-center rounded-full border-0 bg-transparent p-1"
        href="https://www.linkedin.com/in/jose-gonzalo-tarqui-ticona-746251332/"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="LinkedIn"
      >
        <span class="tech-icon fill-current inline-block" style="width:40px;height:40px;">
          <LN class="w-full h-full fill-current" />
        </span>
      </a>

      <!-- CV: descarga -->
      <a
        id="cvLink"
        class="tech-pill tech-cv inline-flex items-center justify-center rounded-full border-0 bg-transparent p-1"
        href="/assets/CV.pdf"
        download
        aria-label="Descargar CV"
      >
        <span class="tech-icon fill-current inline-block" style="width:40px;height:40px;">
          <CV class="w-full h-full fill-current" />
        </span>
      </a>
    </div>
  </div>

  <!-- Toast "Copiado" -->
  <div id="copyToast" class="pointer-events-none fixed bottom-12 left-1/2 transform -translate-x-1/2 bg-[var(--toggle-sun)] text-white px-4 py-2 rounded-full opacity-0 transition-opacity duration-300 z-50">
    Copiado
  </div>

  <style is:global>
    /* colores y hover (usa el mismo efecto neon que tienes para .tech-pill) */
    .tech-wsp { --tech-color: #25D366; }      /* WhatsApp verde */
    .tech-gmail { --tech-color: #D44638; }    /* Gmail rojo */
    .tech-linkedin { --tech-color: #0077B5; } /* LinkedIn azul */
    .tech-cv { --tech-color: var(--color-internet); } /* CV: usa color de internet (azul) */

    /* Asegurar que .tech-pill hover use la variable --tech-color local */
    .tech-pill.tech-wsp:hover .tech-icon,
    .tech-pill.tech-gmail:hover .tech-icon,
    .tech-pill.tech-linkedin:hover .tech-icon,
    .tech-pill.tech-cv:hover .tech-icon {
      color: var(--tech-color);
      filter: drop-shadow(0 0 6px rgba(255,255,255,0.95)) drop-shadow(0 0 12px var(--tech-color));
    }

    /* ligeramente más grande el popover top para no cortarse */
    #wspPopover { width: 11rem; }
    @media(min-width:768px) { #wspPopover { width: 12rem; } }

    /* animación toast */
    @keyframes toast-fade {
      0% { opacity: 0; transform: translateY(6px) scale(.98); }
      10% { opacity: 1; transform: translateY(0) scale(1); }
      90% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-6px) scale(.98); }
    }
  </style>

  <script type="module" client:load>
    // ELEMENTOS
    const wspBtn = document.getElementById('wspBtn');
    const wspPopover = document.getElementById('wspPopover');
    const wspClose = document.getElementById('wspClose');
    const wspImg = document.getElementById('wspImg');
    const wspImgError = document.getElementById('wspImgError');

    const gmailBtn = document.getElementById('gmailBtn');
    const copyToast = document.getElementById('copyToast');
    const EMAIL = 'tarquijoseticona@gmail.com';

    // SHOW/HIDE QR
    function showWsp() { wspPopover.classList.remove('hidden'); }
    function hideWsp() { wspPopover.classList.add('hidden'); }

    wspBtn?.addEventListener('click', (e) => {
      e.stopPropagation();
      wspPopover.classList.toggle('hidden');
    });
    wspClose?.addEventListener('click', (e) => { e.stopPropagation(); hideWsp(); });

    document.addEventListener('click', (ev) => {
      if (!wspPopover) return;
      if (wspPopover.classList.contains('hidden')) return;
      if (!wspPopover.contains(ev.target) && !wspBtn.contains(ev.target)) {
        hideWsp();
      }
    });

    // IMAGE ERROR handling
    if (wspImg) {
      wspImg.addEventListener('error', () => {
        console.warn('Error loading QR image /assets/jose.jpeg — revisa nombre/ubicación en public/assets');
        wspImg.style.display = 'none';
        if (wspImgError) wspImgError.classList.remove('hidden');
      });
    }

    // COPY EMAIL with toast (3s)
    function showToast() {
      if (!copyToast) return;
      copyToast.style.opacity = '1';
      copyToast.style.animation = 'toast-fade 3s ease forwards';
      // limpiar después de 3.2s
      setTimeout(() => {
        copyToast.style.opacity = '0';
        copyToast.style.animation = '';
      }, 3200);
    }

    gmailBtn?.addEventListener('click', async (e) => {
      e.stopPropagation();
      try {
        await navigator.clipboard.writeText(EMAIL);
        showToast();
      } catch (err) {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = EMAIL;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); showToast(); } catch (e) { console.warn('copy fallback failed', e); }
        document.body.removeChild(ta);
      }
    });
  </script>
</section>
